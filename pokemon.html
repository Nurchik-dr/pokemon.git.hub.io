<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    body {
        font-family: Arial, Helvetica, sans-serif;
        text-transform: capitalize;
    }

    .link {
        margin: 5px;
        display: flex;
        flex-direction: column;
        text-decoration: none;
        width: 150px;
        color: black;
    }

    .info {
        display: flex;
        align-items: flex-start;
        flex-direction: column;
        border: 1px solid;
        padding: 5px;
    }

    a:hover {
        text-decoration: underline;
    }

    img {
        width: 130px;
        height: 130px;
    }

    ol {
        padding-left: 30px;
    }

    #input {
        padding: 5px 7px;
        margin: 10px 0px 0px 10px;
    }

    #btn {
        padding: 5px 7px;
    }

    #loader {
        display: none;
        margin: 8px 0px 0px 30px;
    }

    #error {
        margin: 8px 0px 0px 30px;
    }
</style>

<body>
    <input id="input" type="text" placeholder="Введите id покемона">
    <button id="btn">Поиск</button>
    <div id="loader">Загрузка...</div>
    <p id="error"></p>
    <ol id="list"></ol>

    <script>
        const btn = document.getElementById("btn");
        const loader = document.getElementById("loader");
        const error = document.getElementById("error");
        const input = document.getElementById("input"); // ← исправлено

        async function handleSearch() {
            loader.style.display = "block";
            error.textContent = "";
            const list = document.getElementById("list"); // ← moved сюда
            list.innerHTML = "";

            const id = input.value.trim();
            if (!id) {
                error.textContent = "Введите id покемона!";
                loader.style.display = "none";
                return;
            }
            try {
                const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}/`);
                if (!res.ok) {
                    error.textContent = "Покемон не найден!";
                    loader.style.display = "none";
                    return;
                }
                const data = await res.json();

                const li = document.createElement("li");
                li.innerHTML = `
                    <img src="${data.sprites.front_default}" alt="${data.name}">
                    <h2>${data.name}</h2>
                    <p>ID: ${id}</p>
                    <p>Типы: ${data.types[0].type.name}</p>
                    <p>Рост: ${data.height}</p>
                    <p>Вес: ${data.weight}</p>
                `;
                li.style.listStyle = "none";
                list.appendChild(li);

            } catch (e) {
                console.error(e);
                error.textContent = "Ошибка загрузки данных";
            } finally {
                loader.style.display = "none";
            }
        }

        btn.addEventListener("click", handleSearch);
        input.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                e.preventDefault();
                handleSearch();
            }
        });

        async function pokemonLimit(limit = 20) {
            const res = await fetch("https://pokeapi.co/api/v2/pokemon/");
            const data = await res.json();
            return data.results;
        }

        async function renderPokemons() {
            const list = document.getElementById("list");
            const pokemons = await pokemonLimit(20);

            pokemons.forEach(p => {
                const li = document.createElement("li");
                const link = document.createElement("a");
                link.textContent = p.name;
                link.className = "link";
                link.href = "#";
                link.onclick = () => {
                    showInfo(p.url, link);
                    link.onclick = null;
                }
                li.appendChild(link);
                list.appendChild(li);
            });
        }

        async function showInfo(url, link) {
            const res = await fetch(url);
            const data = await res.json();

            const info = document.createElement("div");
            info.innerHTML = `
                <img src="${data.sprites.front_default}" alt="${data.name}">
                <h2>${data.name}</h2>
                <p>Типы: ${data.types.map(t => t.type.name).join(", ")}</p>
                <p>Рост: ${data.height}</p>
                <p>Вес: ${data.weight}</p>
            `;
            info.className = "info";
            link.appendChild(info);
        }

        renderPokemons();
    </script>
</body>

</html>
